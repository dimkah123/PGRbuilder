/* ==============================================
   PGRBuilder - Main Stylesheet
   ============================================== */

/* ----------------------------------------------
   CSS Variables (Theme Settings)
   ---------------------------------------------- */
:root {
    /* Core Colors */
    --bg-color: #000000;
    /* Main background color */
    --panel-bg: #050505;
    /* Background for panels (Left/Right) */

    /* Text Colors */
    --text-color: #c0c0c0;
    /* Primary text color (Standardized bright gray) */
    --text-dim: #adadad;
    /* Secondary text color (Labels, less important info) */
    --text-highlight: #ffffff;
    /* Highlighted text color */

    /* Accent Colors */
    --accent-red: #ff3333;
    /* Main accent color (Red) */
    --accent-dim: #550000;
    /* Dimmed accent for backgrounds/borders */

    /* UI Elements */
    --border-color: #222;
    /* Default border color */
    --input-bg: #0a0a0a;
    /* Background for input fields */

    /* Fonts */
    /* CYRILLIC FONT STACK */
    --font-header: 'Jura', sans-serif;
    /* Headlines */
    --font-tech: 'JetBrains Mono', monospace;
    /* Technical data / Numbers */
    --font-body: 'Exo 2', sans-serif;
    /* Body text */
}

/* ==============================================
   Light Theme Configuration
   ============================================== */
.light-theme {
    /* Light Theme Variables */
    --bg-color: #f2f2f5;
    --panel-bg: #ffffff;
    --text-color: #1a1a1a;
    --text-highlight: #000000;
    --accent-red: #d32f2f;
    --accent-dim: #f0f0f0;
    --border-color: #e0e0e0;
    --input-bg: #f5f5f7;
}

/* 
   LIGHT THEME OVERRIDES 
   Specific adjustments for elements where variable swapping isn't enough
*/

/* Containers & Slots */
.light-theme .mem-box,
.light-theme .harm-slot,
.light-theme .res-group,
.light-theme .stat-box:not(.empty-state) {
    background-color: #fcfcfc !important;
    border-color: #ccc !important;
}

/* Left Panel Background */
.light-theme .left-panel {
    background-color: var(--panel-bg) !important;
    border-color: #ddd !important;
}

/* Input Fields Text Color */
.light-theme input,
.light-theme .stat-input,
.light-theme .mem-input,
.light-theme .harm-input,
.light-theme .build-title input,
.light-theme .res-val-input,
.light-theme .res-desc-input {
    color: #333 !important;
}

/* Stat Labels (Class, Element, etc.) */
.light-theme .stat-label {
    color: #666 !important;
    background: rgba(0, 0, 0, 0.03) !important;
    border-bottom-color: #ddd !important;
    border-top-color: #ddd !important;
}

/* Top Navigation Bar */
.light-theme .top-nav {
    background: #fff !important;
    color: #333 !important;
    border-bottom-color: #ddd !important;
}

.light-theme .nav-right {
    color: #666;
}

/* Section Headers */
.light-theme .section-header {
    color: #333 !important;
    border-bottom-color: #eee !important;
}

/* Tactical Analysis Box */
.light-theme .tac-box {
    background: rgba(0, 0, 0, 0.02) !important;
    border-color: #ddd !important;
}

/* Rich Text Editor */
.light-theme .rich-textarea {
    color: #333 !important;
}

/* Portrait Placeholder */
.light-theme .portrait-placeholder {
    background-color: #f7f7f7 !important;
    color: #999;
}

/* Borders for various containers */
.light-theme .build-row,
.light-theme .stats-row,
.light-theme .stats-container,
.light-theme .section-header {
    border-bottom-color: #eee !important;
}

/* Decorative Corners */
.light-theme .page-corner {
    border-color: #ccc !important;
}

/* Suggestions Dropdown */
.light-theme .suggestions-box {
    background: #fff !important;
    border-color: #ccc !important;
}

.light-theme .suggestions-box div {
    color: #333 !important;
    border-bottom-color: #eee !important;
}

.light-theme .suggestions-box div:hover {
    background: #f0f0f0 !important;
}

/* Light Theme for Popup Menus & Color Picker */
.light-theme #custom-color-picker,
.light-theme .rte-dropdown-menu {
    background-color: #ffffff !important;
    border-color: #ccc !important;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1) !important;
    color: #333 !important;
}

.light-theme .cp-hex-input {
    background: #f0f0f0 !important;
    color: #333 !important;
    border-color: #ccc !important;
}

.light-theme .cp-btn {
    background: #f0f0f0 !important;
    color: #333 !important;
}

.light-theme .cp-btn:hover {
    background: #e0e0e0 !important;
}

.light-theme .rte-dropdown-item {
    color: #333 !important;
}

.light-theme .rte-dropdown-item:hover {
    background-color: #f0f0f0 !important;
}

/* Light Theme Overrides for Text Inputs */
.light-theme .nav-left,
.light-theme .char-name-input,
.light-theme .section-header,
.light-theme .tac-header,
.light-theme .weapon-textarea,
.light-theme .stat-input {
    color: #333 !important;
}

/* Invert White Icons to Black in Light Theme (EXCEPT Weapon and CUB which are colored) */
.light-theme .stat-icon:not(#weapon-img):not(#cub-img) {
    filter: invert(1);
    opacity: 0.8;
}

/* Light Theme Weapon Resonance */
.light-theme .weapon-res-group {
    background: #fcfcfc !important;
    border-color: #ccc !important;
    border-left: 2px solid #ccc !important;
    /* Match border color */
}

.light-theme .portrait-area {
    border-bottom-color: #ddd !important;
}

.light-theme .weapon-res-box {
    background: #f5f5f7 !important;
    border-color: #ddd !important;
}

.light-theme .weapon-res-box:hover {
    border-color: var(--accent-red) !important;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1) !important;
}

.light-theme .weapon-res-group .res-label {
    color: #555 !important;
}

/* Invert Weapon Resonance Icons in Light Theme */
.light-theme .weapon-res-box img,
.light-theme .wres-item img {
    filter: invert(1);
    opacity: 0.8;
}

/* Light Theme Modals (Char/Mem/Weapon) */
.light-theme .modal-content,
.light-theme .wres-modal-content {
    background: #fff !important;
    border-color: #ccc !important;
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15) !important;
}

.light-theme .modal-header,
.light-theme .wres-modal-header {
    background: #fff !important;
    border-bottom-color: #eee !important;
}

.light-theme .modal-header h3,
.light-theme .wres-modal-header {
    color: #333 !important;
    text-shadow: none !important;
}

.light-theme .modal-close,
.light-theme .wres-modal-close {
    color: #666 !important;
    /* Close button */
}

/* Light Theme Lists (Memories/Characters/WRes) */
.light-theme .mem-option,
.light-theme .wres-item {
    background: #fff !important;
    border-color: #eee !important;
}

.light-theme .mem-option:hover,
.light-theme .wres-item:hover:not(.disabled) {
    background: #f0f0f0 !important;
    border-color: var(--accent-red) !important;
}

.light-theme .mem-opt-name,
.light-theme .wres-item span {
    color: #333 !important;
}

.light-theme .mem-search,
.light-theme .modal-search-box input {
    background: #fff !important;
    color: #333 !important;
    border-bottom-color: #e0e0e0 !important;
    /* Lighter border for search */
}

.light-theme .modal-search-box {
    border-bottom-color: #e0e0e0 !important;
}

/* Light Theme Scrollbars */
.light-theme ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

.light-theme ::-webkit-scrollbar-track {
    background: #f0f0f0;
}

.light-theme ::-webkit-scrollbar-thumb {
    background: #ccc;
    border-radius: 4px;
}

.light-theme ::-webkit-scrollbar-thumb:hover {
    background: #999;
}

/* Fix Black Blocks in Resonance Dropdowns */
.light-theme .custom-res-select .res-select-trigger {
    background-color: #fff !important;
    border-color: #ddd !important;
    color: #333 !important;
}

.light-theme .res-select-options {
    background: #fff !important;
    border-color: #ddd !important;
}

.light-theme .res-select-option {
    background: #fff !important;
    color: #333 !important;
}

.light-theme .res-select-option:hover {
    background: #f5f5f5 !important;
}

/* Windows-style Close Button for Weapon Resonance Modal - Light Theme Override */
.light-theme .wres-modal-close {
    color: #000 !important;
    /* Just force black text for light theme */
}

.light-theme .wres-modal-close:hover {
    background: #e81123 !important;
    color: #fff !important;
    transform: none !important;
}

/* Light Theme Input Highlighting (Mem/Harm) */
.light-theme .mem-input:hover,
.light-theme .mem-input:focus,
.light-theme .harm-input:hover,
.light-theme .harm-input:focus {
    background: #fff !important;
    border: 1px solid #ccc !important;
    color: #000 !important;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

/* Light Theme Harmony Slot Hover */
.light-theme .harm-slot:hover {
    background: #fff !important;
    border-color: #d32f2f !important;
    box-shadow: 0 0 8px rgba(211, 47, 47, 0.4) !important;
}

/* Light Theme Resilience Skill Input */
.light-theme .res-skill-input {
    border-bottom-color: #ccc !important;
    color: #333 !important;
}

/* Fix Weapon Resonance Modal Backgrounds */
.light-theme .wres-item {
    box-shadow: none !important;
    /* Remove heavy shadows */
}

.light-theme .wres-modal-content {
    border: 1px solid #ddd !important;
}

/* Light Theme Buttons */
.light-theme .btn {
    background: #f0f0f0 !important;
    color: #333 !important;
    border-color: #ccc !important;
}

.light-theme .btn:hover {
    background: #e0e0e0 !important;
    border-color: #999 !important;
}


/* ==============================================
   Base Styles
   ============================================== */

/* ==============================================
   Layout & Core Structure
   ============================================== */

/* 
   Global Smooth Theme Transition 
   ----------------------------------------------
   This block ensures that ALL elements transition their colors/backgrounds/borders
   smoothly when the 'changing-theme' class is applied to the body.
   This class is added via JS for 550ms during the toggle.
*/
.changing-theme,
.changing-theme *,
.changing-theme *::before,
.changing-theme *::after {
    transition: all 0.5s ease !important;
    transition-delay: 0s !important;
}

/* 
   Reset Defaults 
   ----------------------------------------------
   Standard reset to ensure consistent box-sizing and remove default margins.
*/
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    user-select: none;
    /* Prevent text selection mostly for app-like feel */
}

/* 
   Custom Scrollbar (Webkit)
   ----------------------------------------------
   Styles for Chrome/Edge/Safari scrollbars to match the dark theme.
*/
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: #1a1a1a;
    /* Dark track */
}

::-webkit-scrollbar-thumb {
    background: #222;
    /* Dark thumb */
    border-radius: 0;
    border: 1px solid var(--accent-red, red);
    /* Accent border on thumb */
}

::-webkit-scrollbar-thumb:hover {
    background: #666;
    /* Lighter on hover */
}

/* 
   Body Switch 
   ----------------------------------------------
   Sets up the main flex container for the page.
*/
body {
    background-color: var(--bg-color);
    color: var(--text-color);
    font-family: var(--font-body);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 0;
    overflow-x: hidden;
    font-weight: 500;
}

/* 
   Top Navigation Bar 
   ----------------------------------------------
   Fixed header at the top of the screen.
*/
.top-nav {
    width: 100%;
    height: 40px;
    background-color: #000;
    border-bottom: 1px solid #333;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 40px;
    font-family: var(--font-header);
    font-weight: 700;
    font-size: 0.9rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: #fff;
    position: fixed;
    top: 0;
    z-index: 100;
}

.nav-left span {
    color: var(--accent-red);
    margin-right: 10px;
}

.nav-right {
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: var(--font-tech);
    color: var(--text-dim);
    font-size: 0.75rem;
}

.status-dot {
    width: 8px;
    height: 8px;
    background-color: #00ff00;
    /* Green active status */
    border-radius: 50%;
    box-shadow: 0 0 5px #00ff00;
    /* Glow effect */
}

/* 
   Main Application Container 
   ----------------------------------------------
   Grid layout holding the Left (Character) and Right (Build) panels.
*/
.app-container {
    margin-top: 60px;
    /* Offset for fixed header */
    display: grid;
    grid-template-columns: 400px 1fr;
    /* Fixed 400px Left Panel, Fluid Right Panel */
    gap: 40px;
    width: 95%;
    max-width: 1800px;
    margin-bottom: 40px;
    position: relative;
}

/* 
   Decorative Corner Brackets 
   ----------------------------------------------
   Purely visual elements adding a "tech" look to the corners of the page.
*/
.page-corner {
    position: absolute;
    width: 20px;
    height: 20px;
    border: 2px solid #333;
    pointer-events: none;
}

.pc-tl {
    top: -10px;
    left: -10px;
    border-right: none;
    border-bottom: none;
}

.pc-tr {
    top: -10px;
    right: -10px;
    border-left: none;
    border-bottom: none;
}

.pc-bl {
    bottom: -10px;
    left: -10px;
    border-right: none;
    border-top: none;
}

.pc-br {
    bottom: -10px;
    right: -10px;
    border-left: none;
    border-top: none;
}

/* ==============================================
   Left Panel - Character Info
   ============================================== */
.left-panel {
    display: flex;
    flex-direction: column;
    height: 850px;
    border: 1px solid #1a1a1a;
    background-color: var(--panel-bg);
    /* Solid color for smooth transition */
    position: relative;
}

/* 
   Portrait Area 
   ----------------------------------------------
   Container for the character image and placeholder.
*/
.portrait-area {
    flex-grow: 1;
    /* Takes up remaining height */
    position: relative;
    overflow: hidden;
    border-bottom: 1px solid #222;
}

.portrait-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: top center;
    display: none;
    /* Hidden until image is selected */
}

/* Placeholder when no image is loaded */
.portrait-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #333;
    font-family: var(--font-header);
    font-weight: 700;
    text-transform: uppercase;
    cursor: pointer;
    flex-direction: column;
    gap: 10px;
    background-color: var(--panel-bg);
    /* Default background matching panel */
}

.portrait-placeholder:hover {
    color: var(--accent-red);
    background-color: #080000;
    /* Subtle darkening on hover */
}

.img-controls {
    display: none !important;
    /* Force hide old controls */
}

/* "Change Character" Button overlay */
.char-change-btn {
    position: absolute;
    bottom: 10px;
    right: 10px;
    width: 30px;
    height: 30px;
    background: rgba(0, 0, 0, 0.6);
    color: #fff;
    border: 1px solid #fff;
    border-radius: 0;
    display: none;
    /* Toggled by JS */
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 1.2rem;
    z-index: 21;
    transition: all 0.2s;
    opacity: 0;
    pointer-events: none;
}

.char-change-btn:hover {
    background: var(--accent-red);
    color: #fff;
}

/* Show button on hover */
.portrait-area:hover .char-change-btn {
    opacity: 1;
    pointer-events: auto;
}

/* 
   Name Plate 
   ----------------------------------------------
   Character Name and Frame/Rank inputs.
*/
.name-plate {
    padding: 10px 20px;
    border-left: 4px solid var(--accent-red);
    margin: 10px 0;
    display: flex;
    flex-direction: column;
    overflow: visible;
    /* Allowing text to be visible */
}

.char-name-input {
    width: 100%;
    background: transparent;
    border: none;
    color: #fff;
    font-family: var(--font-header);
    font-weight: 700;
    font-size: 2.5rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: 0px;
    line-height: 1.1;
    padding: 0;
    display: block;
}

.frame-name-input {
    width: 100%;
    background: transparent;
    border: none;
    color: var(--accent-red);
    font-family: var(--font-header);
    font-weight: 600;
    font-size: 1.2rem;
    text-transform: uppercase;
    letter-spacing: 4px;
    line-height: 1.2;
    padding-top: 2px;
}

/* 
   Stats Area 
   ----------------------------------------------
   Grid of stats (Class, Element, Weapon, etc.)
*/
.stats-container {
    display: flex;
    flex-direction: column;
}

.stats-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    /* 3 Equal Columns */
    height: 130px;
}

/* Individual Stat Box */
.stat-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    border-right: 1px solid #222;
    padding: 0;
    padding-bottom: 5px;
    position: relative;
    overflow: hidden;
    background-color: var(--panel-bg);
    /* Solid background for smooth fade */
}

.stat-box:last-child {
    border-right: none;
}

.stat-box.empty-state {
    justify-content: center;
}

.stat-icon {
    width: 60px;
    height: 60px;
    opacity: 0.9;
    object-fit: contain;
    margin-bottom: 2px;
    margin-top: auto;
}

/* Labels (e.g., "CLASS", "WEAPON") */
.stat-label {
    font-family: var(--font-tech);
    font-size: 0.65rem;
    color: var(--text-dim);
    letter-spacing: 1px;
    position: static;
    width: 100%;
    text-align: center;
    border-bottom: 1px solid #222;
    border-top: 1px solid #222;
    padding: 4px 0;
    background: rgba(255, 255, 255, 0.02);
    margin-bottom: 5px;
}

/* Input/Text below icons */
.stat-input {
    width: 100%;
    text-align: center;
    background: transparent;
    border: none;
    color: #fff;
    font-family: var(--font-body);
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.95rem;
    line-height: 1.5;
    padding: 2px 0;
    margin-top: auto;
}

.weapon-textarea {
    width: 100%;
    text-align: center;
    background: transparent;
    border: none;
    color: #fff;
    font-family: var(--font-body);
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.75rem;
    line-height: 1.1;
    padding: 4px 0;
    resize: none;
    height: 38px;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: auto;
}

.rank-input {
    font-size: 2rem !important;
    color: var(--accent-red) !important;
    line-height: 1.5 !important;
    padding: 5px 0 !important;
    margin-top: auto;
    margin-bottom: auto;
}

/* ==============================================
   Right Panel - Configurations
   ============================================== */
.right-panel {
    display: flex;
    flex-direction: column;
}

/* 
   Section Headers 
   ----------------------------------------------
   Titles for each build section (e.g., "Build 1", "Build 2")
*/
.section-header {
    font-family: var(--font-header);
    font-weight: 700;
    color: #fff;
    font-size: 1.5rem;
    margin-bottom: 5px;
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    border-bottom: 1px solid #1a1a1a;
    padding-bottom: 10px;
}

.section-header span {
    color: var(--accent-red);
    font-size: 1rem;
}

/* 
   Build Row Layout
   ----------------------------------------------
   Definitions for the main grid that holds the memory slots,
   harmony slots, and resonance columns for a single build.
*/
.build-row {
    /* Local variables for grid sizing */
    --slot-size: 100px;
    --mem-gap: 10px;
    --mem-col-width: calc(var(--slot-size) * 3 + var(--mem-gap) * 2);
    margin-bottom: 10px;
    display: grid;
    /* Grid Columns: Memories | Harmony | Weapon Res | Res | Controls */
    grid-template-columns: var(--mem-col-width) var(--slot-size) 220px 1fr 30px;
    gap: 10px;
    border-bottom: 1px solid #111;
    padding-bottom: 10px;
    position: relative;
}

/* Lift build-row above others when dropdown is open */
.build-row:has(.custom-res-select.open) {
    z-index: 10000;
}

.build-title {
    grid-column: 1 / -1;
    /* Title spans full width */
    font-family: var(--font-tech);
    color: var(--accent-red);
    font-size: 1.1rem;
    margin-bottom: 0px;
    display: flex;
    align-items: baseline;
    gap: 10px;
}

.build-title input {
    background: transparent;
    border: none;
    color: var(--accent-red);
    font-family: inherit;
    font-size: inherit;
    width: 300px;
    text-transform: uppercase;
    line-height: 1.4;
}

/* 
   Memories Grid 
   ----------------------------------------------
   2x3 Grid for the 6 memory slots.
*/
.mem-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(2, auto);
    gap: var(--mem-gap);
    align-self: start;
}

.mem-cell {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

/* Individual Memory Slot */
.mem-box {
    width: 100%;
    aspect-ratio: 1;
    /* Keep square */
    background: #080808;
    border: 1px solid #222;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
}

.mem-box img {
    width: 90%;
    height: 90%;
    object-fit: cover;
}

.mem-box:hover {
    border-color: #444;
}

/* Memory Level Input */
.mem-input {
    width: 100%;
    text-align: center;
    background: transparent;
    border: 1px solid transparent;
    color: #666;
    font-family: var(--font-tech);
    font-size: 0.7rem;
    height: 20px;
    line-height: 20px;
    display: block;
    transition: all 0.2s;
}

.mem-input:hover,
.mem-input:focus {
    background: #111;
    border: 1px solid #333;
    color: #fff;
    outline: none;
}

/* Remove Button (Red 'X') */
.mem-remove-btn {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 20px;
    height: 20px;
    background: #b30000;
    border: 1px solid #000;
    border-radius: 50%;
    color: #fff;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 20;
    font-size: 16px;
    line-height: 1;
    font-family: Arial, sans-serif;
    opacity: 0;
    transform: scale(0.5) rotate(-90deg);
    transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    /** Fun bouncy animation */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
    pointer-events: none;
    /* Prevent clicks when hidden */
}

/* 
   Empty State Visuals (Double Frame)
   ----------------------------------------------
   Creates a "frame within a frame" look for empty slots.
*/
/* 1. Hide the empty image so no broken icon appears */
.mem-cell:not(.has-item) img,
.harm-col:not(.has-item) img {
    display: none !important;
}

/* 2. Create the "Inner Frame" using ::after pseudo-element */
.mem-cell:not(.has-item) .mem-box::after,
.harm-col:not(.has-item) .harm-slot::after {
    content: "";
    position: absolute;
    top: 5px;
    left: 5px;
    right: 5px;
    bottom: 5px;
    /* Inset for double frame look */
    border: 1px solid #ccc;
    /* Light grey inner frame */
    pointer-events: none;
}

.mem-cell.has-item:hover .mem-remove-btn,
.harm-col.has-item:hover .mem-remove-btn {
    opacity: 1;
    transform: scale(1) rotate(0deg);
    pointer-events: auto;
}

.mem-remove-btn:hover {
    background: #ff3333;
    transform: scale(1.15) rotate(90deg);
}

.mem-remove-btn:active {
    transform: scale(0.95) rotate(90deg);
}

/* 
   Harmonization Slots 
   ----------------------------------------------
   Vertical column for the two harmony slots.
*/
.harm-col {
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-self: start;
    position: relative;
}

.harm-slot {
    width: 100%;
    aspect-ratio: 1;
    background: #0a0505;
    border: 1px solid var(--accent-dim);
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    margin-bottom: 5px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.harm-slot:hover {
    border-color: #ff4d4d;
    background: #1a1a1a;
    box-shadow: 0 0 8px rgba(255, 50, 50, 0.4);
}

.harm-slot img {
    width: 90%;
    height: 90%;
    object-fit: cover;
}

.harm-input {
    width: 100%;
    text-align: center;
    background: transparent;
    border: 1px solid transparent;
    /* Prepare for border highlight */
    color: var(--accent-red);
    font-family: var(--font-tech);
    font-size: 0.7rem;
    height: 20px;
    line-height: 20px;
    display: block;
    transition: all 0.2s;
    /* Smooth transition */
}

.harm-input:hover,
.harm-input:focus {
    background: #111;
    border: 1px solid #333;
    color: #fff;
    outline: none;
}

/* 
   Resonance & Skills 
   ----------------------------------------------
   Logic for resonance skill selection dropdowns.
*/
.res-col {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-self: start;
    padding-top: 0;
}

.res-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
    background: #080808;
    border: 1px solid #1a1a1a;
    padding: 10px;
    border-left: 2px solid #333;
    overflow: visible;
}

.res-label {
    font-family: var(--font-tech);
    color: var(--accent-red);
    font-size: 0.65rem;
    letter-spacing: 1px;
    text-transform: uppercase;
}

.res-row {
    display: flex;
    gap: 5px;
    align-items: center;
    width: 100%;
    /* Ensure row fits container */
    /* overflow: hidden; REMOVED - breaks dropdown */
}

.res-slot-select {
    /* Hidden input styling mostly irrelevant, but keep consistent */
    display: none;
}

/* 
   Custom Dropdown Component 
   ----------------------------------------------
   Replaces specific native <select> elements for better styling.
*/
.custom-res-select {
    position: relative;
    width: 20px;
    min-width: 20px;
    /* Micro size */
    height: 24px;
    font-family: var(--font-tech);
    font-size: 0.8rem;
    /* Smaller Font */
    cursor: pointer;
    user-select: none;
    z-index: 10;
    flex-shrink: 0;
}

/* Open State High Z-Index */
.custom-res-select.open {
    z-index: 10001 !important;
    position: relative;
    /* Force on top when open */
}

/* Ensure parent containers don't clip open dropdown */
.res-group:has(.custom-res-select.open) {
    z-index: 10000;
    position: relative;
}

.res-col:has(.custom-res-select.open) {
    z-index: 10000;
}

.res-select-trigger {
    position: relative;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: var(--accent-red);
    background-color: var(--input-bg);
    border: 1px solid transparent;
    transition: all 0.2s;
    font-weight: 700;
    /* Bolder for visibility */
}

.custom-res-select:hover .res-select-trigger,
.custom-res-select.open .res-select-trigger {
    background: #000;
    border-color: #333;
}

.res-select-options {
    position: absolute;
    top: 100%;
    left: 0;
    width: auto;
    min-width: 35px;
    background: #000;
    border: 1px solid #333;
    display: none;
    flex-direction: column;
    z-index: 100000;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.8);
    white-space: nowrap;
}

.custom-res-select.open .res-select-options {
    display: flex;
}

.res-select-option {
    padding: 3px 4px;
    text-align: center;
    color: #888;
    transition: background 0.2s, color 0.2s;
    font-size: 0.75rem;
    cursor: pointer;
}

.res-select-option:hover {
    background: #222;
    color: #fff;
    cursor: pointer;
}

.res-select-option.selected {
    color: var(--accent-red);
}

/* 
   Weapon Resonance Input 
   ----------------------------------------------
   Small input field for the specific skill ID or Value.
*/
.res-skill-input {
    background: transparent;
    border: none;
    border-bottom: 1px solid #333;
    padding: 2px 5px;
    color: var(--text-color);
    font-family: var(--font-body);
    font-size: 0.8rem;
    height: 24px;
    flex: 1;
    /* Stretch to fill space */
    min-width: 0;
    width: 0;
    box-sizing: border-box;
    outline: none;
}

.res-skill-input:focus {
    border-bottom-color: var(--accent-red);
    color: #fff;
}

/* ==============================================
   Weapon Resonance UI
   ============================================== */
.weapon-res-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
    background: #080808;
    border: 1px solid #1a1a1a;
    padding: 10px;
    border-left: 2px solid #333;
}

.weapon-res-row {
    display: flex;
    gap: 5px;
    justify-content: flex-start;
}

.weapon-res-cell {
    display: flex;
    flex-direction: column;
    align-items: center;
}

/* Slot for Weapon Resonance Icon */
.weapon-res-box {
    width: 40px;
    height: 40px;
    background: #0a0505;
    border: 1px solid var(--accent-dim);
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.weapon-res-box:hover {
    border-color: #ff4d4d;
    background: #1a1a1a;
    box-shadow: 0 0 8px rgba(255, 50, 50, 0.4);
}

.weapon-res-box img {
    width: 90%;
    height: 90%;
    object-fit: cover;
}

/* 
   Weapon Resonance Selector Modal 
   ----------------------------------------------
   Popup for choosing weapon resonance skills.
*/
.wres-modal-content {
    background: #111;
    border: 1px solid #333;
    padding: 20px;
    position: relative;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
}

.wres-modal-header {
    font-family: var(--font-header);
    color: var(--accent-red);
    font-size: 1rem;
    margin-bottom: 15px;
    text-align: center;
    letter-spacing: 2px;
}

.wres-modal-close {
    position: absolute;
    top: 0;
    right: 0;
    width: 40px;
    height: 30px;
    background: transparent;
    color: #fff;
    border-radius: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    font-size: 1.2rem;
    font-family: sans-serif;
    transition: all 0.1s;
    border: none;
    z-index: 10;
}

.wres-modal-close:hover {
    background: #e81123;
    color: #fff;
    transform: none;
}

/* Grid of available resonance skills */
.wres-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
}

.wres-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    background: #0a0a0a;
    border: 1px solid #222;
    cursor: pointer;
    transition: all 0.2s;
}

.wres-item:hover:not(.disabled) {
    border-color: #ff4d4d;
    background: #1a1a1a;
    box-shadow: 0 0 8px rgba(255, 50, 50, 0.4);
}

.wres-item.disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

.wres-item img {
    width: 50px;
    height: 50px;
    object-fit: contain;
    margin-bottom: 5px;
}

.wres-item span {
    font-size: 0.65rem;
    color: var(--text-dim);
    text-align: center;
    font-family: var(--font-tech);
}

/* Light Theme Overrides for Weapon Res Modal */
.light-theme .custom-res-select:hover .res-select-trigger,
.light-theme .custom-res-select.open .res-select-trigger {
    background: #fff;
    border-color: #ccc;
}

.light-theme .res-select-options {
    background: #fff;
    border-color: #ccc;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.light-theme .res-select-option {
    color: #666;
}

.light-theme .res-select-option:hover {
    background: #f0f0f0;
    color: #000;
}

.res-skill-input {
    flex-grow: 1;
    background: transparent;
    border: none;
    border-bottom: 1px solid #222;
    color: #fff;
    font-family: var(--font-body);
    font-weight: 700;
    font-size: 0.9rem;
    height: 24px;
    padding-left: 5px;
}

/* ==============================================
   Tactical Analysis (Notes) Section
   ============================================== */
.tac-box {
    position: relative;
    height: 100%;
    padding: 15px;
    border: 1px solid #1a1a1a;
    background: rgba(255, 255, 255, 0.01);
    overflow: hidden;
    max-width: 100%;
}

/* Corner Brackets for Tech Look */
.corner-bracket {
    position: absolute;
    width: 15px;
    height: 15px;
    pointer-events: none;
    border-color: #444;
    border-style: solid;
}

.cb-tl {
    top: -1px;
    left: -1px;
    border-width: 2px 0 0 2px;
}

.cb-br {
    bottom: -1px;
    right: -1px;
    border-width: 0 2px 2px 0;
}

.tac-header {
    font-family: var(--font-header);
    font-weight: 700;
    color: #fff;
    font-size: 0.8rem;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    opacity: 0.7;
}

.tac-header::before {
    content: '';
    width: 3px;
    height: 12px;
    background: var(--accent-red);
}

/* ==============================================
   Rich Text Editor
   ============================================== */
.rich-editor-container {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    background: transparent;
    position: relative;
}

/* Floating Toolbar (Bold, Italic, Color) */
.rte-toolbar {
    position: fixed;
    display: none;
    /* Hidden by default */
    z-index: 10000;
    background: #1a1a1a;
    border: 1px solid #333;
    padding: 4px;
    gap: 4px;
    border-radius: 4px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.8);
    align-items: center;
}

/* Triangle pointer for toolbar */
.rte-toolbar::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #1a1a1a transparent transparent transparent;
}

.rte-toolbar.visible {
    display: flex;
    animation: fadeIn 0.15s cubic-bezier(0.2, 0, 0.2, 1);
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(8px) scale(0.95);
    }

    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.rte-btn {
    background: transparent;
    border: none;
    color: #ccc;
    cursor: pointer;
    padding: 4px 6px;
    font-size: 0.85rem;
    font-weight: 600;
    font-family: var(--font-body);
    border-radius: 2px;
    transition: all 0.15s;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 24px;
}

.rte-btn:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.1);
}

.rte-btn.active {
    color: var(--accent-red);
    background: rgba(211, 47, 47, 0.15);
}

/* Editor Dropdown Menus */
.rte-dropdown {
    position: relative;
    display: inline-block;
}

.rte-dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 6px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.9);
    z-index: 10001;
    padding: 5px;
    min-width: 100px;
    margin-top: 5px;
    flex-direction: column;
    gap: 2px;
}

.rte-dropdown.active .rte-dropdown-menu {
    display: flex;
    animation: fadeInMenu 0.1s ease-out;
}

@keyframes fadeInMenu {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.rte-menu-item {
    padding: 6px 10px;
    color: #ccc;
    font-family: var(--font-body);
    font-size: 0.85rem;
    cursor: pointer;
    border-radius: 4px;
    transition: background 0.1s;
}

.rte-menu-item:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
}

/* Color Palette Picker */
.color-menu {
    display: none;
    flex-direction: row;
    align-items: center;
    gap: 5px;
    padding: 8px;
    min-width: auto;
    background: #1a1a1a;
    border-radius: 6px;
    border: 1px solid #333;
}

.rte-dropdown.active .color-menu {
    display: flex;
}

.color-swatch {
    width: 20px;
    height: 20px;
    border-radius: 4px;
    cursor: pointer;
    border: 1px solid #444;
    transition: transform 0.1s;
    position: relative;
}

.color-swatch:hover {
    transform: scale(1.2);
    border-color: #fff;
    z-index: 10;
}

.color-separator {
    width: 1px;
    height: 20px;
    background: #444;
    margin: 0 5px;
}

/* Gradient Wheel Icon */
.custom-picker {
    background: conic-gradient(from 180deg at 50% 50%, #FF0000 0deg, #FFFF00 60deg, #00FF00 120deg, #00FFFF 180deg, #0000FF 240deg, #FF00FF 300deg, #FF0000 360deg);
    border-radius: 50%;
    border: 1px solid #555;
    overflow: hidden;
}

.color-indicator {
    width: 12px;
    height: 12px;
    background: linear-gradient(135deg, #fff 50%, #d32f2f 50%);
    border-radius: 50%;
    border: 1px solid #555;
    display: inline-block;
}

.rte-color-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

#rte-color-input {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
    left: 0;
    top: 0;
    z-index: 10;
}

.rich-textarea {
    flex-grow: 1;
    padding: 10px;
    color: #999;
    font-family: var(--font-body);
    font-size: 0.95rem;
    line-height: 1.5;
    outline: none;
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-wrap: break-word;
    overflow-x: hidden;
    max-width: 100%;
}

.rich-textarea:focus {
    color: #ccc;
}

/* 
   Syntax/Keyword Highlighting 
   ----------------------------------------------
   Styles for spans created by the custom highlighter.
*/
.term-highlight {
    color: #ffaa00;
    border-bottom: 1px dotted #ffaa00;
    cursor: help;
    position: relative;
}

/* Tooltip on hover for terms */
.term-highlight:hover::after {
    content: attr(data-desc);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(10, 10, 10, 0.95);
    border: 1px solid var(--accent-red);
    color: #fff;
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 0.75rem;
    width: max-content;
    max-width: 250px;
    z-index: 1000;
    white-space: normal;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.8);
    pointer-events: none;
}

.separator-line {
    display: block;
    width: 100%;
    height: 1px;
    background: #333;
    margin: 10px 0;
}

input:focus {
    outline: none;
    /* Remove default browser outline */
}

/* ==============================================
   Button Components
   ============================================== */
.ctrl-panel {
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    z-index: 200;
}

.btn {
    background: #000;
    border: 1px solid #333;
    color: #fff;
    padding: 10px 20px;
    font-family: var(--font-header);
    cursor: pointer;
    text-transform: uppercase;
    font-size: 0.8rem;
    transition: all 0.2s;
}

.btn:hover {
    border-color: var(--accent-red);
    color: var(--accent-red);
}

.btn-del {
    background: transparent;
    border: none;
    color: #333;
    font-size: 1.5rem;
    cursor: pointer;
}

.btn-del:hover {
    color: var(--accent-red);
}

/* ==============================================
   Autocomplete Dropdowns
   ============================================== */
.hidden-file {
    display: none !important;
}

.autocomplete-wrapper {
    position: relative;
    display: inline-block;
    width: 100%;
}

.autocomplete-items {
    position: absolute;
    border: 1px solid #333;
    border-bottom: none;
    border-top: none;
    z-index: 9999;
    top: 100%;
    left: 0;
    right: 0;
    background-color: #0a0a0a;
    max-height: 200px;
    overflow-y: auto;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
}

.autocomplete-item {
    padding: 10px;
    cursor: pointer;
    border-bottom: 1px solid #222;
    color: #a0a0a0;
    font-family: var(--font-body);
    font-size: 0.9rem;
    transition: all 0.1s;
}

.autocomplete-item:hover {
    background-color: #1a1a1a;
    color: #fff;
    border-left: 2px solid var(--accent-red);
}

.autocomplete-active {
    background-color: #1a1a1a !important;
    color: #fff !important;
    border-left: 2px solid var(--accent-red);
}

.autocomplete-item strong {
    color: var(--accent-red);
}

/* ==============================================
   Modal Dialogs
   ============================================== */
.modal-overlay {
    display: none;
    /* Flex when active */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    z-index: 10000;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(5px);
}

.modal-content {
    background: #0a0a0a;
    border: 1px solid #333;
    width: 500px;
    max-width: 90%;
    height: 600px;
    display: flex;
    flex-direction: column;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
    position: relative;
}

.modal-header {
    padding: 15px 20px;
    border-bottom: 1px solid #222;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #050505;
}

.modal-header h3 {
    font-family: var(--font-header);
    color: var(--accent-red);
    font-size: 1rem;
    letter-spacing: 2px;
}

.modal-close {
    background: transparent;
    border: none;
    color: #666;
    cursor: pointer;
    font-size: 1.2rem;
}

.modal-close:hover {
    color: #fff;
}

.modal-search-box {
    padding: 15px;
    border-bottom: 1px solid #222;
}

.mem-search {
    width: 100%;
    /* Reverted to 100% */
    background: #111;
    border: none;
    border-bottom: 1px solid #333;
    /* Thinner border might be better? User said 'decorative' */
    padding: 2px 5px;
    color: var(--text-color);
    font-family: var(--font-body);
    font-size: 0.8rem;
    height: 24px;
    flex: 1;
    min-width: 0;
    /* Ensure it tries to fill flex item */
    box-sizing: border-box;
    /* Include padding/border in width */
    outline: none;
}

.mem-search:focus {
    border-color: var(--accent-red);
}

.mem-list {
    flex-grow: 1;
    overflow-y: auto;
    padding: 10px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
    grid-auto-rows: max-content;
    align-content: start;
    gap: 10px;
}

.mem-option {
    background: #0f0f0f;
    border: 1px solid #222;
    padding: 10px;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    transition: all 0.2s;
}

.mem-option:hover {
    border-color: var(--accent-red);
    background: #151515;
}

.mem-opt-img {
    width: 60px;
    height: 60px;
    object-fit: contain;
    background: transparent;
}

.mem-opt-name {
    font-family: var(--font-body);
    font-size: 0.75rem;
    color: #aaa;
    text-align: center;
}

/* ==============================================
   Image Controls / Management
   ============================================== */
.portrait-area {
    position: relative;
    overflow: hidden !important;
}

/* Clear Button on Memory Slots */
.mem-clear-btn {
    position: absolute;
    top: 0;
    right: 0;
    background: rgba(220, 20, 60, 0.9);
    color: #fff;
    width: 18px;
    height: 18px;
    font-size: 14px;
    line-height: 16px;
    text-align: center;
    cursor: pointer;
    display: none;
    /* Hidden by default */
    z-index: 10;
    font-weight: bold;
}

.mem-box.has-mem:hover .mem-clear-btn {
    display: block;
}

.mem-clear-btn:hover {
    background: red;
}

/* Portrait Controls (Zoom/Move) - Legacy support if needed */
.img-controls {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 15px;
    z-index: 20;
    background: rgba(0, 0, 0, 0.6);
    padding: 5px 15px;
    border-radius: 20px;
    opacity: 0;
    transition: opacity 0.3s;
}

.portrait-area:hover .img-controls {
    opacity: 1;
}

.ctl-row {
    display: flex;
    align-items: center;
    gap: 5px;
    color: #fff;
    font-size: 0.8rem;
    font-family: sans-serif;
}

.ctl-row input {
    width: 50px;
    cursor: pointer;
}

/* ==============================================
   Responsive Design (Media Queries)
   ============================================== */

/* Tablet / Netbook */
@media screen and (max-width: 1024px) {
    .app-container {
        display: flex;
        flex-direction: column;
        width: 100%;
        margin-top: 50px;
        gap: 20px;
        padding-bottom: 80px;
    }

    .left-panel {
        width: 100%;
        height: auto;
        border: 1px solid #222;
    }

    .portrait-area {
        height: 500px;
        border-bottom: 1px solid #222;
    }

    .right-panel {
        padding: 0 10px;
    }

    .build-row {
        display: flex;
        flex-direction: column;
        gap: 15px;
        height: auto;
        border-bottom: 1px solid #222;
        padding-bottom: 20px;
    }

    .build-title {
        width: 100%;
        justify-content: space-between;
    }

    .mem-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 5px;
    }
}

/* Mobile */
@media screen and (max-width: 768px) {
    .top-nav {
        padding: 0 15px;
        font-size: 0.75rem;
        justify-content: center;
        gap: 10px;
        flex-wrap: wrap;
        height: auto;
        min-height: 40px;
        padding-top: 5px;
        padding-bottom: 5px;
    }

    .nav-left span {
        display: block;
        width: 100%;
        text-align: center;
        margin: 0;
    }

    .portrait-area {
        height: 400px;
    }

    .name-plate {
        padding: 10px;
        margin: 5px 0;
    }

    .char-name-input {
        font-size: 2rem;
    }

    .stats-row {
        height: 110px;
    }

    .stat-icon {
        width: 45px;
        height: 45px;
    }

    .mem-grid {
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(2, auto);
        gap: 8px;
    }

    .mem-cell {
        gap: 2px;
    }

    .mem-input {
        font-size: 0.65rem;
        position: static;
        margin-top: 2px;
        width: 100%;
        background: transparent;
        z-index: auto;
        height: 20px;
        line-height: 20px;
        color: #666;
    }

    .harm-col {
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        margin-top: 0;
    }

    .harm-slot {
        width: calc((100% - 16px) / 3);
        aspect-ratio: 1;
        margin: 0;
        /* Revert to original fluid layout */
    }

    .harm-slot:hover {
        border-color: var(--accent-red);
        background: #1a1a1a;
        transform: scale(1.05);
        /* Slight pop */
    }

    .harm-input {
        text-align: center;
        width: calc((100% - 16px) / 3);
    }

    .build-row {
        gap: 8px;
    }

    .build-row>div:nth-child(4) {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        width: 100%;
    }

    .build-row>div:last-child {
        display: flex;
        justify-content: flex-end;
    }

    .ctrl-panel {
        bottom: 10px;
        right: 10px;
        flex-direction: column;
        gap: 5px;
    }

    .btn {
        padding: 8px 12px;
        font-size: 0.7rem;
    }
}

/* ==============================================
   Additional Component Overrides
   ============================================== */
/* Rank Box */
.rank-box {
    justify-content: center !important;
    padding-bottom: 0 !important;
}

/* ==============================================
   Custom Color Picker
   ============================================== */
#custom-color-picker * {
    box-sizing: border-box;
}

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

#cp-rgb-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 30px;
    gap: 8px;
    margin-bottom: 12px;
    align-items: end;
}

.cp-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: monospace;
    font-size: 0.7rem;
    color: #888;
    font-weight: bold;
}

.cp-num-input {
    width: 100%;
    background: #222;
    border: 1px solid #444;
    color: #fff;
    text-align: center;
    padding: 4px 0;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-top: 3px;
}

.cp-num-input:focus {
    border-color: #d32f2f;
    background: #111;
    outline: none;
}

#cp-sat-box {
    position: relative;
    overflow: hidden;
}

#cp-sat-handle {
    pointer-events: none;
}

/* Hue Slider Rainbow */
#cp-hue-slider {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 10px;
    border-radius: 5px;
    background: linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
    outline: none;
    margin-bottom: 15px !important;
    cursor: pointer;
    border: 1px solid #333;
}

#cp-hue-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: transparent;
    border: 2px solid #fff;
    box-shadow: 0 0 2px rgba(0, 0, 0, 0.8);
    cursor: pointer;
    margin-top: 0px;
}

#cp-hue-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: transparent;
    border: 2px solid #fff;
    box-shadow: 0 0 2px rgba(0, 0, 0, 0.8);
    cursor: pointer;
}

/* Selection Visibility */
.color-picking-mode *::selection {
    background: rgba(255, 255, 255, 0.2) !important;
    color: inherit !important;
}

/* Recent Colors */
.recent-swatch {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 1px solid #444;
    cursor: pointer;
    transition: transform 0.1s;
}

.recent-swatch:hover {
    transform: scale(1.2);
    border-color: #fff;
}

/* Custom Picker Styles */
#custom-color-picker * {
    box-sizing: border-box;
}

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

#cp-rgb-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 30px;
    gap: 8px;
    margin-bottom: 12px;
    align-items: end;
}

.cp-col {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: monospace;
    font-size: 0.7rem;
    color: #888;
    font-weight: bold;
}

.cp-num-input {
    width: 100%;
    background: #222;
    border: 1px solid #444;
    color: #fff;
    text-align: center;
    padding: 4px 0;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-top: 3px;
}

.cp-num-input:focus {
    border-color: #d32f2f;
    background: #111;
    outline: none;
}

/* Hue Slider Rainbow */
#cp-hue-slider {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 10px;
    border-radius: 5px;
    background: linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%);
    outline: none;
    margin-bottom: 15px !important;
    cursor: pointer;
    border: 1px solid #333;
}

#cp-hue-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: transparent;
    border: 2px solid #fff;
    box-shadow: 0 0 2px rgba(0, 0, 0, 0.8);
    cursor: pointer;
    margin-top: 0px;
}

#cp-hue-slider::-moz-range-thumb {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: transparent;
    border: 2px solid #fff;
    box-shadow: 0 0 2px rgba(0, 0, 0, 0.8);
    cursor: pointer;
}

/* Selection Visibility */
.color-picking-mode *::selection {
    background: rgba(255, 255, 255, 0.2) !important;
    color: inherit !important;
}

/* Recent Colors */
.recent-swatch {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    border: 1px solid #444;
    cursor: pointer;
    transition: transform 0.1s;
}

.recent-swatch:hover {
    transform: scale(1.2);
    border-color: #fff;
}

/* UI Locking (until character selected) */
.ui-locked {
    pointer-events: none;
    opacity: 0.5;
    filter: grayscale(100%);
    transition: all 0.5s ease;
}

/* Add Build Wide Button */
.add-build-area {
    margin-top: 10px;
    padding-bottom: 20px;
}

.add-build-wide-btn {
    width: 100%;
    background: transparent;
    border: 1px dashed #333;
    color: #555;
    font-family: var(--font-tech);
    font-size: 0.9rem;
    padding: 15px;
    cursor: pointer;
    text-transform: uppercase;
    transition: all 0.2s;
    letter-spacing: 1px;
}

.add-build-wide-btn:hover {
    border-color: var(--accent-red);
    color: #fff;
    background: rgba(255, 255, 255, 0.02);
}

.light-theme .add-build-wide-btn {
    border-color: #ccc;
    color: #888;
}

.light-theme .add-build-wide-btn:hover {
    border-color: var(--accent-red);
    color: #333;
    background: rgba(0, 0, 0, 0.02);
}

/* Build Row Animations */
.build-row {
    transition: max-height 0.3s ease-out, margin 0.3s ease-out, padding 0.3s ease-out, opacity 0.3s ease-out;
    max-height: 800px;
    /* Allow growth but defined for transition */
    overflow: hidden;
    /* Required for height animation */
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes fadeOut {
    from {
        opacity: 1;
        transform: scale(1);
    }

    to {
        opacity: 0;
        transform: scale(0.95);
    }
}

.build-row.adding {
    animation: slideDown 0.3s ease-out forwards;
}

.build-row.removing {
    animation: fadeOut 0.3s ease-in forwards;
    pointer-events: none;

    /* Collapsing transition */
    max-height: 0;
    margin-bottom: 0;
    padding-bottom: 0;
    border-bottom-width: 0;
    opacity: 0;
}